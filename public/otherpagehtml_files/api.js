(function(){var a=window.elbphilharmonie;if(typeof a=="undefined"){window.elbphilharmonie={};a=window.elbphilharmonie}if(typeof a.SetActivityId=="function"){return}a._initialActivityId="3rrqzjyevz0stdx0c5fgmpge";a._activityIdChangeEvents=new Array();a.Debug=false;a.VersionInfo="1.0";a.ActivityId="3rrqzjyevz0stdx0c5fgmpge";a.SetActivityId=function(b){if(typeof b=="string"&&a.ActivityId!==b){a.LogDebugInfo("ActivityId changed: "+a.ActivityId+" => "+b);a.ActivityId=b;a._activityIdChangeEvents.forEach(function(c){setTimeout(function(){a.TriggerActivityIdChangeEvent(c)})})}};a.GetActivityId=function(){return a.ActivityId};a.AddActivityIdChangeEvent=function(b){if(typeof b=="function"){a._activityIdChangeEvents.push(b);if(a.ActivityId!==a._initialActivityId){a.TriggerActivityIdChangeEvent(b)}}};a.Initialize=function(){if(a.Debug){a.LogDebugInfo("debugging is enabled")}a.LogDebugInfo("current activityId is: "+a.ActivityId)};a.LogDebugInfo=function(b){if(a.Debug){console.log("Elbphilharmonie API (V "+a.VersionInfo+"): "+b)}};a.TriggerActivityIdChangeEvent=function(b){if(typeof b=="function"){try{b(a.ActivityId)}catch(c){a.LogDebugInfo('The "TriggerActivityIdChangeEvent" threw an exception! - Message: '+c)}}};a.Initialize()})();(function(){if(!false){return}var d="";var f=document.getElementsByTagName("script");var c=false;for(var b=0;b<f.length;b++){if(typeof f[b].src==="string"&&f[b].src===d){c=true}}if(!c){var e=document.createElement("script");e.src=d;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}})();(function(){if(typeof window.elbphilharmonie.WebshopApi=="object"){return}var a=function(){var b=this;this._jQuery=null;this._jQueryLoadCounter=0;this._jQueryLoadDelay=50;this._useOwnJQuery=false;this._cartTimout=null;this._cartItemCount=0;this._cartItemCountOtherInventories=0;this.Debug=false;this.OnActivityIdChanged=undefined;this.DoExecuteAfterAuthentification=undefined;this.VersionInfo="1.1";this.ApiCallback_GetCurrentCart="https://shop.elbphilharmonie.de/en/webservices/cart/EN/GetCurrentCart.json";this.ApiCallback_ValidateActivityId="https://shop-services.elbphilharmonie.de/Activities/en/validateactivityid.json";this.ApiCallback_NotifyOnActivityIdChange="https://shop.elbphilharmonie.de/en/webshop/NotifyOnActivityIdChange.json?Language=EN";this.JsonResultCode_Ok=0;this.JsonResultCode_Error=2;this.JsonResultCode_Warning=1;this.JsonErrorCode_AcivityDoesntContainCart=200091;this.Resource_CartTimeout="Min.";this.GetActivityId=function(){return window.elbphilharmonie.ActivityId};this.SetActivityId=function(c){window.elbphilharmonie.SetActivityId(c)};this.Intialize=function(e){window.elbphilharmonie.AddActivityIdChangeEvent(b.ActivityIdChangeHandler);var d=window.jQuery;if(b._useOwnJQuery){b.LogDebugInfo("Use the apis own jQuery version.");d=window.elbphilharmonie.jQuery}if(typeof d=="undefined"){if(b._jQueryLoadCounter<20){var c=b._jQueryLoadCounter++*b._jQueryLoadDelay;b.LogDebugInfo("Cannot find jQuery. Checking again in "+c+"ms.");setTimeout(function(){b.Intialize(e)},c)}else{throw'jQuery is not available. Please include jQuery in your code or call the api-script with the Parameter "?loadJQuery=yes".'}}else{b._jQuery=d;b.LogDebugInfo("jQuery found ("+b._jQuery.fn.jquery+"). Starting initialization.");b.DoIntialize(e)}};this.DoIntialize=function(f){try{f()}catch(e){b.LogDebugInfo('"onWebshopApiReady" threw an exception! - Message: '+e)}if(b.Debug){b.LogDebugInfo("debugging is enabled")}b.LogDebugInfo("current activityId is: "+b.GetActivityId());var c=b._jQuery(".webshop-variable-cart-timeout").attr("data-cart-timeout");if(typeof c!="undefined"&&c!==false){b._cartTimout=new Date(c);b.LogDebugInfo("current cart timeout is: "+b._cartTimout.toUTCString())}var d;c=b._jQuery(".webshop-variable-cart-itemcount").attr("data-cart-itemcount");if(typeof c!="undefined"&&c!==false){d=parseInt(c);if(!isNaN(d)&&d>=0){b._cartItemCount=d;b.LogDebugInfo("current cart item count is: "+b._cartItemCount)}}c=b._jQuery(".webshop-variable-cart-itemcount").attr("data-cart-itemcount-inventory");if(typeof c!="undefined"&&c!==false){d=parseInt(c);if(!isNaN(d)&&d>=0&&d<=b._cartItemCount){b._cartItemCountOtherInventories=b._cartItemCount-d;b.LogDebugInfo("current cart item count of other inventories is: "+b._cartItemCountOtherInventories)}}if(typeof onWebshopApiInitialized=="function"){try{onWebshopApiInitialized(b)}catch(e){b.LogDebugInfo('"onWebshopApiInitialized" threw an exception! - Message: '+e)}}window.setInterval(b.UpdateCartTimeout,5000);b.TriggerLoginStatusUpdate()};this.LogDebugInfo=function(c){if(b.Debug){console.log("Webshop API (V "+b.VersionInfo+"): "+c)}};this.GetCartItemCount=function(){return b._cartItemCount};this.SetInventoryCartProductCount=function(c){b.LogDebugInfo("SetInventoryCartProductCount called: "+c);if(typeof c=="undefined"||isNaN(c)){return}b.SetCartProductCount(c+b._cartItemCountOtherInventories)};this.SetCartProductCount=function(c){b.LogDebugInfo("SetCartProductCount called: "+c);if(typeof c=="undefined"||isNaN(c)){return}if(c>=0){b._cartItemCount=c}else{b._cartItemCount=0}b.UpdateCartItemCount()};this.SetCartTimeout=function(c){if(c instanceof Date||c==null){if(c!=null){b.LogDebugInfo("SetCartTimeout called: "+c.toUTCString())}else{b.LogDebugInfo("SetCartTimeout called: Remove cart timeout")}b._cartTimout=c;b.UpdateCartTimeout()}else{b.LogDebugInfo("SetCartTimeout called. Cannot interprete the timestamp as date object: "+c)}};this.TriggerLoginStatusUpdate=function(){var d=false;var c;var e=function(f){if(typeof f.NewActivityId=="string"&&f.NewActivityId!==""){SetActivityId(f.NewActivityId)}if(f.ResultCode===b.JsonResultCode_Ok){var h=typeof f.User!="undefined"&&f.User!=null;if(h){b._jQuery(".webshop-variable-displayname-short").html(f.User.Displayname);b._jQuery(".webshop-variable-displayname-long").html(f.User.Displayname);b._jQuery(".webshop-variable-customer-number").html(f.User.CustomerNumber);b._jQuery(".webshop-variable-email").html(f.User.Email);b._jQuery(".webshop-block-login").hide();b._jQuery(".webshop-block-user-account").show()}else{b._jQuery(".webshop-block-login").show();b._jQuery(".webshop-block-user-account").hide()}if(typeof onWebshopApiLoginStatusChanged=="function"){try{onWebshopApiLoginStatusChanged(h)}catch(g){b.LogDebugInfo('"onWebshopApiLoginStatusChanged" threw an exception! - Message: '+g)}}}else{if(!d){d=true;c()}}};c=function(){b.LogDebugInfo("Updating login status: "+b.ApiCallback_ValidateActivityId);b._jQuery.ajax({type:"POST",url:b.ApiCallback_ValidateActivityId,data:{ActivityId:b.GetActivityId()},success:e,dataType:"json"})};c()};this.TriggerCartUpdate=function(){var d=false;var c;var e=function(f){if(typeof f.NewActivityId=="string"&&f.NewActivityId!==""){SetActivityId(f.NewActivityId)}if(f.ResultCode===b.JsonResultCode_Ok){b.SetCartProductCount(f.Cart.NumberOfItems);b.SetCartTimeout(new Date(f.Cart.HoldTimeout))}else{if(f.ResultCode===b.JsonResultCode_Error&&f.FirstErrorCode===b.JsonErrorCode_AcivityDoesntContainCart){b.SetCartProductCount(0);b.SetCartTimeout(null)}else{if(!d){d=true;c()}}}};c=function(){b.LogDebugInfo("Updating cart info: "+b.ApiCallback_GetCurrentCart);b._jQuery.ajax({type:"POST",url:b.ApiCallback_GetCurrentCart,data:{ActivityId:b.GetActivityId()},success:e,dataType:"json"})};c()};this.UpdateCartTimeout=function(){if(typeof b._cartTimout=="undefined"||b._cartTimout==null){b._jQuery(".webshop-variable-cart-timeout").hide();return}var g=new Date();var d=0;if(g<b._cartTimout){var c=b._cartTimout-g;var e=Math.floor(c/1000/60/60);d=e*60;if(e<10){e="0"+e}c-=e*1000*60*60;var f=Math.floor(c/1000/60);d=d+f;if(f<10){f="0"+f}c-=f*1000*60;var h=Math.floor(c/1000);if(h<10){h="0"+h}c-=h*1000;b.LogDebugInfo("cart valid for: "+e+":"+f+":"+h)}if(b._cartItemCount>0){b._jQuery(".webshop-variable-cart-timeout").html(d+" "+b.Resource_CartTimeout).show()}else{b._jQuery(".webshop-variable-cart-timeout").hide()}};this.UpdateCartItemCount=function(){if(b._cartItemCount<=0){b._jQuery(".webshop-variable-cart-timeout").hide();b._jQuery(".webshop-variable-cart-itemcount").hide()}else{b._jQuery(".webshop-variable-cart-itemcount").html(b._cartItemCount).show()}if(typeof onWebshopApiCartCountChanged=="function"){try{onWebshopApiCartCountChanged(b._cartItemCount)}catch(c){b.LogDebugInfo('"onWebshopApiCartCountChanged" threw an exception! - Message: '+c)}}};this.ActivityIdChangeHandler=function(d){if(true&&typeof d=="string"&&d!==""){var e=function(f){if(f.ResultCode===b.JsonResultCode_Ok){b.LogDebugInfo("Activity id change has been confirmed.")}};b.LogDebugInfo("Notify on activity id change: "+b.ApiCallback_NotifyOnActivityIdChange);b._jQuery.ajax({type:"POST",url:b.ApiCallback_NotifyOnActivityIdChange,data:{NewActivityId:d},success:e,dataType:"json"})}if(typeof b.OnActivityIdChanged=="function"){try{b.OnActivityIdChanged(d)}catch(c){b.LogDebugInfo('The "OnActivityIdChanged" threw an exception! - Message: '+c)}}}};if(typeof window.elbphilharmonie.WebshopApi!="object"){window.elbphilharmonie.WebshopApi=new a();window.elbphilharmonie.WebshopApi.Intialize(function(){if(typeof(onWebshopApiReady)==="function"){onWebshopApiReady(window.elbphilharmonie.WebshopApi)}})}})();